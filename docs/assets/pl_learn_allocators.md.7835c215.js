import{_ as s,c as a,o as l,d as n}from"./app.8706ebaa.js";const C=JSON.parse('{"title":"Allokatory","description":"","frontmatter":{},"headers":[{"level":2,"title":"Wbudowane allokatory","slug":"wbudowane-allokatory","link":"#wbudowane-allokatory","children":[{"level":3,"title":"RecyclingRegionAllocator","slug":"recyclingregionallocator","link":"#recyclingregionallocator","children":[]},{"level":3,"title":"LazyRegionAllocator","slug":"lazyregionallocator","link":"#lazyregionallocator","children":[]},{"level":3,"title":"Modyfikowanie wbudowanych allokator\xF3w","slug":"modyfikowanie-wbudowanych-allokatorow","link":"#modyfikowanie-wbudowanych-allokatorow","children":[]},{"level":3,"title":"Tworzenie w\u0142asnej logiki \u015Bwiata","slug":"tworzenie-w\u0142asnej-logiki-swiata","link":"#tworzenie-w\u0142asnej-logiki-swiata","children":[]}]}],"relativePath":"pl/learn/allocators.md"}'),o={name:"pl/learn/allocators.md"},e=n(`<h1 id="allokatory" tabindex="-1">Allokatory <a class="header-anchor" href="#allokatory" aria-hidden="true">#</a></h1><p>Allokatory odpowiadaj\u0105 za przydzielanie przestrzeni dla map, na kt\xF3rych b\u0119dzie rozgrywa\u0107 si\u0119 gra. Mo\u017Cesz modyfikowa\u0107 wbudowane allokatory, zmieniaj\u0105c w nich \u015Brodowisko lub domy\u015Bln\u0105 logik\u0119, albo tworzy\u0107 w\u0142asne, np. dzia\u0142aj\u0105ce na SlimeWorld.</p><h2 id="wbudowane-allokatory" tabindex="-1">Wbudowane allokatory <a class="header-anchor" href="#wbudowane-allokatory" aria-hidden="true">#</a></h2><p>Wbudowane allokatory dzia\u0142aj\u0105 na zasadzie przydzielania fragment\xF3w specjalnego \u015Bwiata.</p><h3 id="recyclingregionallocator" tabindex="-1">RecyclingRegionAllocator <a class="header-anchor" href="#recyclingregionallocator" aria-hidden="true">#</a></h3><ul><li>Najlepiej sprawdza si\u0119 przy d\u0142ugotrwa\u0142ych alokacjach.</li><li>Dzia\u0142a w obr\u0119bie jednego \u015Bwiata Minecraft.</li><li>Ponownie wykorzystuje teren, kt\xF3ry zosta\u0142 wcze\u015Bniej zwolniony.</li><li>Wymaga r\u0119cznego oczyszczenia terenu przed jego zwolnieniem.</li></ul><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">Allocators</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">defaultRecyclingAllocator</span><span style="color:#89DDFF;">();</span></span>
<span class="line"></span></code></pre></div><h3 id="lazyregionallocator" tabindex="-1">LazyRegionAllocator <a class="header-anchor" href="#lazyregionallocator" aria-hidden="true">#</a></h3><ul><li>Idealny do kr\xF3tkotrwa\u0142ych i cz\u0119stych alokacji.</li><li>Automatycznie i bardzo wydajnie czy\u015Bci teren, wi\u0119c r\u0119czne czyszczenie nie jest potrzebne.</li><li>Zu\u017Cywa wi\u0119cej miejsca na dysku.</li></ul><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">Allocators</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">defaultLazyAllocator</span><span style="color:#89DDFF;">();</span></span>
<span class="line"></span></code></pre></div><div class="danger custom-block"><p class="custom-block-title">DANGER</p><p>Nie u\u017Cywaj tego allokatora do d\u0142ugotrwa\u0142ych kontener\xF3w ani kontener\xF3w dzia\u0142aj\u0105cych przez ca\u0142y czas dzia\u0142ania serwera. Mo\u017Ce to spowodowa\u0107 zablokowanie \u015Bwiata, kt\xF3ry b\u0119dzie czeka\u0142 na zwolnienie terenu, kt\xF3ry nigdy si\u0119 nie zwolni.</p></div><h3 id="modyfikowanie-wbudowanych-allokatorow" tabindex="-1">Modyfikowanie wbudowanych allokator\xF3w <a class="header-anchor" href="#modyfikowanie-wbudowanych-allokatorow" aria-hidden="true">#</a></h3><h4 id="mozesz-zmieniac-rozne-parametry-wbudowanych-allokatorow" tabindex="-1">Mo\u017Cesz zmienia\u0107 r\xF3\u017Cne parametry wbudowanych allokator\xF3w: <a class="header-anchor" href="#mozesz-zmieniac-rozne-parametry-wbudowanych-allokatorow" aria-hidden="true">#</a></h4><ul><li><code>worldMaxAlloc</code> \u2013 po ilu przydzieleniach mapy \u015Bwiat ma zosta\u0107 zresetowany.</li><li><code>regionSize</code> \u2013 rozmiar przydzielonych obszar\xF3w.</li><li><code>spaceGap</code> \u2013 odleg\u0142o\u015B\u0107 mi\u0119dzy obszarami.</li><li><code>worldCreatorConsumer</code> \u2013 konsumer do modyfikowania WorldCreator.</li><li><code>worldConsumer</code> \u2013 konsumer wywo\u0142ywany po utworzeniu nowego \u015Bwiata.</li><li><code>worldDestroyConsumer</code> \u2013 konsumer wywo\u0142ywany po zniszczeniu \u015Bwiata.</li></ul><h4 id="domyslna-logika" tabindex="-1">Domy\u015Blna logika <a class="header-anchor" href="#domyslna-logika" aria-hidden="true">#</a></h4><ul><li><code>Allocators::registerDefaultWorldLogic</code> - ustawia domy\u015Bln\u0105 logik\u0119 przy tworzeniu \u015Bwiata (np. zawsze noc, brak naturalnego spawnu mob\xF3w).</li><li><code>Allocators::unregisterDefaultWorldLogic</code> - usuwa domy\u015Bln\u0105 logik\u0119 przy usuwaniu \u015Bwiata.</li></ul><div class="tip custom-block"><p class="custom-block-title">Je\u015Bli domy\u015Blna logika nie pasuje do Twojego projektu, mo\u017Cesz:</p><ul><li>Utworzy\u0107 nowy allokator na bazie domy\u015Blnego z w\u0142\u0105sn\u0105 logik\u0105.</li><li>Zaprojektowa\u0107 w\u0142asny allokator.</li></ul></div><h4 id="przyk\u0142ady-modyfikacji-wbudowanych-allokatorow" tabindex="-1">Przyk\u0142ady modyfikacji wbudowanych allokator\xF3w: <a class="header-anchor" href="#przyk\u0142ady-modyfikacji-wbudowanych-allokatorow" aria-hidden="true">#</a></h4><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> modyfiedAlloator </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">LazyRegionAllocator</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">        worldMaxAlloc</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">        regionSize</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        spaceGap</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">worldCreator</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">-&gt;</span><span style="color:#A6ACCD;"> worldCreator</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">environment</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">World</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Environment</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">NETHER</span><span style="color:#89DDFF;">),</span></span>
<span class="line"><span style="color:#A6ACCD;">        Allocators</span><span style="color:#89DDFF;">::</span><span style="color:#A6ACCD;">registerWorld</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        Allocators</span><span style="color:#89DDFF;">::</span><span style="color:#A6ACCD;">unregisterWorld</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> modyfiedAlloator </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">RecyclingRegionAllocator</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">        regionSize</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        spaceGap</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">worldCreator</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">-&gt;</span><span style="color:#A6ACCD;"> worldCreator</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">environment</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">World</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">Environment</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">END</span><span style="color:#89DDFF;">),</span></span>
<span class="line"><span style="color:#A6ACCD;">        Allocators</span><span style="color:#89DDFF;">::</span><span style="color:#A6ACCD;">registerWorld</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        Allocators</span><span style="color:#89DDFF;">::</span><span style="color:#A6ACCD;">unregisterWorld</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span></code></pre></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Dla tego samego typu allokatora u\u017Cywaj jednej wsp\xF3lnej instancji dla wszystkich map. Tworzenie wielu instancji tego samego typu jest nieefektywne.</p></div><h3 id="tworzenie-w\u0142asnej-logiki-swiata" tabindex="-1">Tworzenie w\u0142asnej logiki \u015Bwiata <a class="header-anchor" href="#tworzenie-w\u0142asnej-logiki-swiata" aria-hidden="true">#</a></h3><p>Poni\u017Cej przyk\u0142ad w\u0142asnej logiki, kt\xF3ra ustawia czas na noc i rejestruje listener dla \u015Bwiata:</p><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Map</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">World</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">BukkitTask</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> worldBukkitTaskMap </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">HashMap</span><span style="color:#89DDFF;">&lt;&gt;();</span></span>
<span class="line"><span style="color:#C792EA;">private</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Map</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">World</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Listener</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> worldListenerMap </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">HashMap</span><span style="color:#89DDFF;">&lt;&gt;();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">registerDefaultWorldLogic</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">World</span><span style="color:#A6ACCD;"> world</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> task </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Scheduler</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">runTaskTimer</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">-&gt;</span><span style="color:#A6ACCD;"> world</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setTime</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">13000L</span><span style="color:#89DDFF;">),</span></span>
<span class="line"><span style="color:#A6ACCD;">    Time</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">zero</span><span style="color:#89DDFF;">(),</span></span>
<span class="line"><span style="color:#A6ACCD;">    Time</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">seconds</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">450</span><span style="color:#89DDFF;">));</span></span>
<span class="line"><span style="color:#A6ACCD;">    worldBukkitTaskMap</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">put</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">world</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> task</span><span style="color:#89DDFF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> listener </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">MyWorldListener</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">world</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    Bukkit</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getPluginManager</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">registerEvents</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">listener</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> CraftContainers</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">instance</span><span style="color:#89DDFF;">());</span></span>
<span class="line"><span style="color:#A6ACCD;">    worldListenerMap</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">put</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">world</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> listener</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">unregisterDefaultWorldLogic</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">World</span><span style="color:#A6ACCD;"> world</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> task </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> worldBukkitTaskMap</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">remove</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">world</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    task</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cancel</span><span style="color:#89DDFF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">var</span><span style="color:#A6ACCD;"> listener </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> worldListenerMap</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">remove</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">world</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">    HandlerList</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unregisterAll</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">listener</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div>`,24),p=[e];function r(t,c,i,y,D,A){return l(),a("div",null,p)}const d=s(o,[["render",r]]);export{C as __pageData,d as default};
